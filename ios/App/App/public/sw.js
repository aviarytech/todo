(()=>{var s="lisa-v3";self.addEventListener("install",e=>{e.waitUntil(self.skipWaiting())});self.addEventListener("activate",e=>{e.waitUntil(Promise.all([caches.keys().then(t=>Promise.all(t.filter(n=>n!==s).map(n=>(console.log("[SW] Deleting old cache:",n),caches.delete(n))))),self.clients.claim()]))});self.addEventListener("fetch",e=>{let{request:t}=e,n=new URL(t.url);if(t.method==="GET"&&t.url.startsWith("http")&&!t.url.includes("convex.cloud")&&!(n.pathname.startsWith("/assets/")&&/[-\.][a-f0-9]{8,}\.(js|css|woff2?)$/.test(n.pathname))){if(t.mode==="navigate"){e.respondWith(fetch(t).then(i=>{if(i.ok){let a=i.clone();caches.open(s).then(o=>{o.put(t,a)})}return i}).catch(async()=>{let i=await caches.match(t);if(i)return i;let a=await caches.match("/");return a||new Response("Offline",{status:503,statusText:"Service Unavailable",headers:{"Content-Type":"text/plain"}})}));return}if(n.origin===self.location.origin){e.respondWith(caches.match(t).then(i=>i||fetch(t).then(a=>{if(a.ok){let o=a.clone();caches.open(s).then(c=>{c.put(t,o)})}return a})));return}}});self.addEventListener("message",e=>{e.data==="skipWaiting"&&self.skipWaiting(),e.data==="clearCaches"&&caches.keys().then(t=>{t.forEach(n=>caches.delete(n))})});self.addEventListener("push",e=>{if(e.data)try{let t=e.data.json(),n=t.title||"\u{1F4A9} Poo App",i={body:t.body||"You have a notification",icon:"/pwa-192x192.png",badge:"/pwa-192x192.png",tag:t.tag||"poo-notification",data:{url:t.url||"/",itemId:t.itemId,listId:t.listId},requireInteraction:t.requireInteraction||!1,vibrate:[100,50,100]};e.waitUntil(self.registration.showNotification(n,i))}catch{let t=e.data.text();e.waitUntil(self.registration.showNotification("\u{1F4A9} Poo App",{body:t,icon:"/pwa-192x192.png"}))}});self.addEventListener("notificationclick",e=>{e.notification.close();let t=e.notification.data?.url||"/app";e.waitUntil(self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(n=>{for(let i of n)if("focus"in i){i.focus(),"navigate"in i&&i.navigate(t);return}return self.clients.openWindow(t)}))});})();
