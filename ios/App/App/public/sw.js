(()=>{var c="lisa-v4",r=["/","/manifest.json","/pwa-192x192.png","/pwa-512x512.png"];self.addEventListener("install",e=>{e.waitUntil(caches.open(c).then(async t=>(await Promise.allSettled(r.map(i=>t.add(i).catch(n=>{console.warn("[SW] Failed to pre-cache:",i,n)}))),self.skipWaiting())))});self.addEventListener("activate",e=>{e.waitUntil(Promise.all([caches.keys().then(t=>Promise.all(t.filter(i=>i!==c).map(i=>(console.log("[SW] Deleting old cache:",i),caches.delete(i))))),self.clients.claim()]))});self.addEventListener("fetch",e=>{let{request:t}=e,i=new URL(t.url);if(t.method==="GET"&&t.url.startsWith("http")&&!t.url.includes("convex.cloud")){if(i.pathname.startsWith("/assets/")&&/[-\.][a-f0-9]{8,}\.(js|css|woff2?)$/.test(i.pathname)){e.respondWith(caches.match(t).then(n=>n||fetch(t).then(a=>{if(a.ok){let o=a.clone();caches.open(c).then(s=>{s.put(t,o)})}return a})));return}if(t.mode==="navigate"){e.respondWith(fetch(t).then(n=>{if(n.ok){let a=n.clone();caches.open(c).then(o=>{o.put(t,a)})}return n}).catch(async()=>{let n=await caches.match(t);if(n)return n;let a=await caches.match("/");return a||new Response("Offline",{status:503,statusText:"Service Unavailable",headers:{"Content-Type":"text/plain"}})}));return}if(i.origin===self.location.origin){e.respondWith(caches.match(t).then(n=>n||fetch(t).then(a=>{if(a.ok){let o=a.clone();caches.open(c).then(s=>{s.put(t,o)})}return a})));return}}});self.addEventListener("message",e=>{e.data==="skipWaiting"&&self.skipWaiting(),e.data==="clearCaches"&&caches.keys().then(t=>{t.forEach(i=>caches.delete(i))})});self.addEventListener("push",e=>{if(e.data)try{let t=e.data.json(),i=t.title||"\u{1F4A9} Poo App",n={body:t.body||"You have a notification",icon:"/pwa-192x192.png",badge:"/pwa-192x192.png",tag:t.tag||"poo-notification",data:{url:t.url||"/",itemId:t.itemId,listId:t.listId},requireInteraction:t.requireInteraction||!1,vibrate:[100,50,100]};e.waitUntil(self.registration.showNotification(i,n))}catch{let t=e.data.text();e.waitUntil(self.registration.showNotification("\u{1F4A9} Poo App",{body:t,icon:"/pwa-192x192.png"}))}});self.addEventListener("notificationclick",e=>{e.notification.close();let t=e.notification.data?.url||"/app";e.waitUntil(self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(i=>{for(let n of i)if("focus"in n){n.focus(),"navigate"in n&&n.navigate(t);return}return self.clients.openWindow(t)}))});})();
