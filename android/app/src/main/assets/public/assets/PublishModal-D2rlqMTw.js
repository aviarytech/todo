import{u as U,f as B,o as A,b as d,c as k,a as S,j as e,n as v}from"./index-DkDPUQpr.js";import{d as c}from"./react-vendor-BToC6Ez8.js";import"./originals-sdk-C0s467Ca.js";function F(r){const i=r.replace("did:webvh:",""),a=encodeURIComponent(i);return`${window.location.origin}/public/${a}`}const O="lisa.aviary.tech";function T({list:r,onClose:i}){const{did:a,subOrgId:u}=U(),{haptic:t}=B(),N=A(d.didCreation.createListDID),w=k(d.publication.publishList),L=k(d.publication.unpublishList),o=S(d.publication.getPublicationStatus,{listId:r._id}),[m,b]=c.useState(!1),[g,p]=c.useState(!1),[y,j]=c.useState(!1),[f,l]=c.useState(null),n=o?.status==="active",x=n?F(o.webvhDid):null,C=async()=>{if(!a||!u){l("You must be logged in to publish a list");return}b(!0),l(null),t("medium");try{const s=`list-${r._id.replace(/[^a-zA-Z0-9-]/g,"")}`,h=await N({subOrgId:u,domain:O,slug:s});await w({listId:r._id,webvhDid:h.did,didDocument:JSON.stringify(h.didDocument),didLog:JSON.stringify(h.didLog),publisherDid:a}),t("success")}catch(s){console.error("[PublishModal] Failed to publish:",s),l(s instanceof Error?s.message:"Failed to publish list"),t("error")}finally{b(!1)}},P=async()=>{if(!a){l("You must be logged in to unpublish a list");return}p(!0),l(null),t("medium");try{await L({listId:r._id,userDid:a}),t("success")}catch(s){console.error("[PublishModal] Failed to unpublish:",s),l(s instanceof Error?s.message:"Failed to unpublish list"),t("error")}finally{p(!1)}},I=async()=>{if(x)try{await navigator.clipboard.writeText(x),t("success"),j(!0),setTimeout(()=>j(!1),2e3)}catch(s){console.error("Failed to copy:",s),t("error")}},D=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl leading-none",children:n?"ðŸŒ":"ðŸ“¤"}),e.jsxs("div",{children:[e.jsx("h2",{id:"publish-dialog-title",className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:n?"Published List":"Publish List"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate max-w-[200px]",children:r.name})]})]}),e.jsx("button",{onClick:i,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),M=n?e.jsxs("div",{className:"px-5 py-4 flex gap-3",children:[e.jsx("button",{onClick:P,disabled:g,className:"flex-1 px-4 py-3 text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 rounded-xl font-medium hover:bg-red-100 dark:hover:bg-red-900/30 disabled:opacity-50 transition-colors",children:g?"Unpublishing...":"Unpublish"}),e.jsx("button",{onClick:i,className:"flex-1 px-4 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-semibold transition-colors",children:"Done"})]}):e.jsxs("div",{className:"px-5 py-4 flex gap-3",children:[e.jsx("button",{onClick:()=>{t("light"),i()},className:"flex-1 px-4 py-3 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-xl font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:C,disabled:m,className:"flex-1 px-4 py-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white rounded-xl font-semibold shadow-lg shadow-amber-500/25 disabled:opacity-50 transition-all",children:m?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Publishing..."]}):"Publish List"})]});return o===void 0?e.jsx(v,{isOpen:!0,onClose:i,title:"Loading...",ariaLabelledBy:"publish-dialog-title",children:e.jsx("div",{className:"p-5",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("svg",{className:"w-8 h-8 animate-spin text-amber-500",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})})}):e.jsx(v,{isOpen:!0,onClose:i,header:D,footer:M,ariaLabelledBy:"publish-dialog-title",children:e.jsxs("div",{className:"p-5 space-y-4",children:[n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800 dark:text-green-400",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"font-medium",children:"This list is published"})]}),e.jsx("p",{className:"mt-1 text-sm text-green-700 dark:text-green-500",children:"Anyone with the link can view this list."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Public URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x??"",readOnly:!0,className:"flex-1 px-4 py-3 text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl text-sm"}),e.jsx("button",{onClick:I,className:`px-4 py-3 rounded-xl font-medium transition-all ${y?"bg-green-500 text-white":"bg-amber-500 hover:bg-amber-600 text-white"}`,children:y?"âœ“":"Copy"})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-xl",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"DID:"})," ",e.jsx("span",{className:"font-mono text-xs break-all",children:o.webvhDid})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Publishing makes this list publicly viewable. Anyone with the link can see the list contents and verify who added each item."}),e.jsx("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3 text-amber-800 dark:text-amber-400",children:[e.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Before you publish"}),e.jsxs("ul",{className:"mt-2 text-sm space-y-1 text-amber-700 dark:text-amber-500",children:[e.jsx("li",{children:"â€¢ All items will be publicly visible"}),e.jsx("li",{children:"â€¢ Contributor names will be shown"}),e.jsx("li",{children:"â€¢ The list URL will be shareable"})]})]})]})})]}),f&&e.jsxs("div",{className:"px-4 py-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl text-red-700 dark:text-red-400 text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),f]})]})})}export{T as PublishModal};
